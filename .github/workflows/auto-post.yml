name: ‚úÖ Auto Blog Post Generator

on:
  workflow_dispatch:

jobs:
  generate-blog:
    runs-on: ubuntu-latest

    env:
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      GIT_EMAIL: ${{ secrets.GIT_EMAIL }}
      GIT_NAME: ${{ secrets.GIT_NAME }}
      GH_TOKEN: ${{ secrets.GH_TOKEN }}

    steps:
      - name: ‚úÖ Step 1 - Checkout Repository
        uses: actions/checkout@v3

      - name: ‚úÖ Step 2 - Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: ‚úÖ Step 3 - Install Dependencies
        run: npm install

      - name: ‚úÖ Step 4 - Run Blog Generator
        run: |
          echo "Running script..."
          node scripts/fetchAndGenerate.mjs || {
            echo "‚ùå Script failed"
            exit 1
          }

      - name: ‚úÖ Step 5 - List Generated Content
        run: |
          echo "üìù Posts:"
          ls -lh content/posts || echo "‚ö†Ô∏è No posts folder"
          echo "üñº Images:"
          ls -lh content/images || echo "‚ö†Ô∏è No images folder"

      - name: ‚úÖ Step 6 - Commit and Push to GitHub
        run: |
          echo "üîê Configuring Git..."
          git config --global user.email "$GIT_EMAIL"
          git config --global user.name "$GIT_NAME"

          git add content/posts/*.md 2>/dev/null || echo "‚ö†Ô∏è No markdown files"
          git add content/images/*.png 2>/dev/null || echo "‚ö†Ô∏è No image files"

          if git diff --cached --quiet; then
            echo "üü° Nothing to commit"
          else
            git commit -m "ü§ñ New AI Post: $(date)"
          fi

          echo "machine github.com\nlogin github-actions\npassword $GH_TOKEN" > ~/.netrc
          git remote set-url origin https://github.com/${{ github.repository }}.git
          git push origin HEAD:main || echo "‚ùå Git push failed"
